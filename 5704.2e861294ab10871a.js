"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[5704],{3923:(b,y,i)=>{i.d(y,{$o:()=>p,_G:()=>u,Vq:()=>g,SQ:()=>d});var p=function(o){return o.Loaded="applePayLoaded",o.FailedToLoad="applePayFailedToLoad",o.Completed="applePayCompleted",o.Canceled="applePayCanceled",o.Failed="applePayFailed",o.DidSelectShippingContact="applePayDidSelectShippingContact",o.DidCreatePaymentMethod="applePayDidCreatePaymentMethod",o}(p||{}),u=function(o){return o.Loaded="googlePayLoaded",o.FailedToLoad="googlePayFailedToLoad",o.Completed="googlePayCompleted",o.Canceled="googlePayCanceled",o.Failed="googlePayFailed",o}(u||{}),g=function(o){return o.Loaded="paymentFlowLoaded",o.FailedToLoad="paymentFlowFailedToLoad",o.Opened="paymentFlowOpened",o.Created="paymentFlowCreated",o.Completed="paymentFlowCompleted",o.Canceled="paymentFlowCanceled",o.Failed="paymentFlowFailed",o}(g||{}),d=function(o){return o.Loaded="paymentSheetLoaded",o.FailedToLoad="paymentSheetFailedToLoad",o.Completed="paymentSheetCompleted",o.Canceled="paymentSheetCanceled",o.Failed="paymentSheetFailed",o}(d||{})},5704:(b,y,i)=>{i.r(y),i.d(y,{PaymentPage:()=>_});var p=i(467),u=i(177),g=i(4341),d=i(4742),o=i(5083),v=i(3923);const f=(0,o.F3)("Stripe",{web:()=>i.e(1651).then(i.bind(i,1651)).then(r=>new r.StripeWeb)});var C=i(1594),F=i(9350),t=i(4438),x=i(3656),z=i(9568),I=i(1626),R=i(2068);function T(r,m){if(1&r){const s=t.RV6();t.j41(0,"ion-button",4),t.bIt("click",function(){t.eBV(s);const a=t.XpG();return t.Njj(a.close())}),t.EFF(1),t.k0s()}if(2&r){const s=t.XpG();t.R7$(),t.JRh(s.text.cancel)}}function L(r,m){if(1&r){const s=t.RV6();t.j41(0,"ion-content",5)(1,"h3"),t.EFF(2,"You have insufficient balance in your wallet. Please add "),t.j41(3,"strong"),t.EFF(4),t.k0s(),t.EFF(5," to continue."),t.k0s(),t.nrm(6,"br")(7,"br"),t.j41(8,"ion-row")(9,"ion-col",6),t.nrm(10,"img",7),t.k0s(),t.nrm(11,"br"),t.j41(12,"ion-col",8)(13,"ion-button",9),t.bIt("click",function(){t.eBV(s);const a=t.XpG();return t.Njj(a.addAmountToWallet())}),t.EFF(14),t.nI1(15,"currency"),t.k0s()()()()}if(2&r){const s=t.XpG();t.R7$(4),t.Lme("",s.setting.currency,"",s.data.amount,""),t.R7$(10),t.SpI("Add ",t.i5U(15,3,s.data.amount,"INR")," to Wallet")}}let _=(()=>{var r;class m{constructor(e,a,n,l){this.navParams=e,this.otherService=a,this.http=n,this.server=l,this.options={key:"",amount:0,name:"",description:"The Daily Fruit",image:"",order_id:"",handler:function(N){var D=new CustomEvent("payment.success",{detail:N,bubbles:!0,cancelable:!0});window.dispatchEvent(D)},prefill:{name:"",email:"",contact:""},notes:{address:""},theme:{color:"#3399cc"}},this.message="Not yet stared",this.paymentId="",this.error="",this.data=e.get("data"),this.user_id=localStorage.getItem("user_id");const c=localStorage.getItem("admin_setting"),h=localStorage.getItem("user_data");null!==c&&(this.setting=JSON.parse(c)),null!==h&&(this.user=JSON.parse(h));const S=localStorage.getItem("app_lang");null!==S&&(this.text=JSON.parse(S),this.text=this.text.text),f.initialize({publishableKey:this.data.stripe_key}),this.meta={counsumer_id:778383,consumer_mac:"sdjksfhsd887f8s"},this.customizations={title:"Wallet Recharge",description:"Wallet Recharge",logo:"https://dicont.s3.amazonaws.com/static/flow-logos/flutterwave-logo.png"},this.customerDetails={name:this.user.name,email:this.user.email,phone_number:this.user.phone}}ngOnInit(){}addAmountToWallet(){var e=this;return(0,p.A)(function*(){if(e.data.amount){const a={user_id:e.user_id,amount:e.data.amount,notes:"Add To Wallet\xa0Razorpay"};(yield e.server.createRazorpayOrder(a)).subscribe(n=>{e.options.key=n.razor_key.replace(/\r\n/g,""),e.options.order_id=n.order_id,e.options.amount=Number(n.amount),e.options.name="The Daily Fruit",e.options.prefill.name="The Daily Fruit",e.options.prefill.email="support@thedailyfruit.in",e.options.prefill.contact="9998887776",e.payNow()})}else e.otherService.toast(e.text.enter_amount)})()}payNow(){if(typeof Razorpay>"u")console.error("Razorpay is not loaded yet.");else{var e=new Razorpay(this.options);e.open(),e.on("payment.failed",function(a){console.error("Payment failed",a.error)})}}onPaymentSuccess(e){var a=this;return(0,p.A)(function*(){let n=e.detail,l={razorpay_order_id:null==n?void 0:n.razorpay_order_id,razorpay_payment_id:null==n?void 0:n.razorpay_payment_id,razorpay_signature:null==n?void 0:n.razorpay_signature};(yield a.server.verifyRazorpayOrder(l)).subscribe(c=>{a.otherService.triggerLoadData.emit(),a.otherService.closeModel(c)}),a.message="Success Payment"})()}updateWallet(e=null){var a=this;return(0,p.A)(function*(){const n={amount:a.data.amount,user_id:localStorage.getItem("user_id"),trans_id:e,payment_method:a.payment_method,notes:"Wallet Recharge"};a.server.updateWallet(n).subscribe(l=>{a.payment_method=null,a.otherService.toast(a.text.payment_added),a.close(e)})})()}close(e=null){var a=this;return(0,p.A)(function*(){a.otherService.closeModel(e)})()}httpPost(){const e={user:localStorage.getItem("user_id"),total:this.data.amount};return this.http.post(this.server.getApiUrl()+"stripePayment",e).pipe((0,C.$)())}paymentSheet(){var e=this;return(0,p.A)(function*(){e.payment_method=1;try{f.addListener(v.SQ.Completed,()=>{});const a=e.httpPost(),{paymentIntent:n,ephemeralKey:l,customer:c}=yield function P(r,m){const s="object"==typeof m;return new Promise((e,a)=>{let l,n=!1;r.subscribe({next:c=>{l=c,n=!0},error:a,complete:()=>{n?e(l):s?e(m.defaultValue):a(new F.G)}})})}(a);yield f.createPaymentSheet({paymentIntentClientSecret:n,customerId:c,customerEphemeralKeySecret:l,merchantDisplayName:e.setting.app_name});const h=yield f.presentPaymentSheet();h&&h.paymentResult===v.SQ.Completed?e.updateWallet(e.splitAndJoin(n)):e.otherService.toast(e.text.payment_cancel)}catch{e.otherService.toast(e.text.payment_cancel)}})()}splitAndJoin(e){return e.split("_").slice(0,2).join("_")}payWithRazorpay(){return(0,p.A)(function*(){})()}}return(r=m).\u0275fac=function(e){return new(e||r)(t.rXU(x.y8),t.rXU(z.G),t.rXU(I.Qq),t.rXU(R.Z))},r.\u0275cmp=t.VBU({type:r,selectors:[["app-payment"]],hostBindings:function(e,a){1&e&&t.bIt("payment.success",function(l){return a.onPaymentSuccess(l)},!1,t.tSv)},decls:5,vars:2,consts:[[1,"ion-no-border"],["slot","end"],["color","medium",3,"click",4,"ngIf"],["class","ion-padding",4,"ngIf"],["color","medium",3,"click"],[1,"ion-padding"],["size","12",2,"text-align","center"],["src","assets/razorpay.gif",2,"width","40%","height","auto","border-radius","25px"],["size","12"],["mode","ios","expand","block","color","dark","id","open-modal","expand","block",3,"click"]],template:function(e,a){1&e&&(t.j41(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-buttons",1),t.DNE(3,T,2,1,"ion-button",2),t.k0s()()(),t.DNE(4,L,16,6,"ion-content",3)),2&e&&(t.R7$(3),t.Y8G("ngIf",a.text),t.R7$(),t.Y8G("ngIf",a.data&&a.text))},dependencies:[d.bv,d.Jm,d.QW,d.hU,d.W9,d.eU,d.ln,d.ai,u.MD,u.bT,u.oe,g.YN],styles:["ion-item[_ngcontent-%COMP%]{border-radius:5px;--min-height:60px;border:1px solid #f1f1f1}ion-toolbar[_ngcontent-%COMP%]{--background: white}ion-thumbnail[_ngcontent-%COMP%]{width:32px;height:32px}"]}),m})()}}]);