"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[1651],{1651:($,f,u)=>{u.r(f),u.d(f,{StripeWeb:()=>_});var o=u(467),q=u(5083),a=u(3923);const F=(n=window)=>{if(typeof n>"u")return[];n.Ionic=n.Ionic||{};let t=n.Ionic.platforms;return null==t&&(t=n.Ionic.platforms=M(n),t.forEach(e=>n.document.documentElement.classList.add(`plt-${e}`))),t},M=n=>Object.keys(C).filter(t=>C[t](n)),y=n=>!!(l(n,/iPad/i)||l(n,/Macintosh/i)&&d(n)),b=n=>l(n,/android|sink/i),d=n=>W(n,"(any-pointer:coarse)"),S=n=>A(n)||P(n),A=n=>!!(n.cordova||n.phonegap||n.PhoneGap),P=n=>{const t=n.Capacitor;return!(null==t||!t.isNative)},l=(n,t)=>t.test(n.navigator.userAgent),W=(n,t)=>n.matchMedia(t).matches,C={ipad:y,iphone:n=>l(n,/iPhone/i),ios:n=>l(n,/iPhone|iPod/i)||y(n),android:b,phablet:n=>{const t=n.innerWidth,e=n.innerHeight,i=Math.min(t,e),r=Math.max(t,e);return i>390&&i<520&&r>620&&r<800},tablet:n=>{const t=n.innerWidth,e=n.innerHeight,i=Math.min(t,e),r=Math.max(t,e);return y(n)||(n=>b(n)&&!l(n,/mobile/i))(n)||i>460&&i<820&&r>780&&r<1400},cordova:A,capacitor:P,electron:n=>l(n,/electron/i),pwa:n=>!(!n.matchMedia("(display-mode: standalone)").matches&&!n.navigator.standalone),mobile:d,mobileweb:n=>d(n)&&!S(n),desktop:n=>!d(n),hybrid:S};class _ extends q.E_{constructor(){super({name:"Stripe",platforms:["web"]})}initialize(t){var e=this;return(0,o.A)(function*(){if("string"!=typeof t.publishableKey||0===t.publishableKey.trim().length)throw new Error("you must provide a valid key");e.publishableKey=t.publishableKey,t.stripeAccount&&(e.stripeAccount=t.stripeAccount)})()}createPaymentSheet(t){var e=this;return(0,o.A)(function*(){var i;e.publishableKey?(e.paymentSheet=document.createElement("stripe-payment-sheet"),null===(i=document.querySelector("body"))||void 0===i||i.appendChild(e.paymentSheet),yield customElements.whenDefined("stripe-payment-sheet"),e.paymentSheet.publishableKey=e.publishableKey,e.stripeAccount&&(e.paymentSheet.stripeAccount=e.stripeAccount),e.paymentSheet.applicationName="@capacitor-community/stripe",e.paymentSheet.intentClientSecret=t.paymentIntentClientSecret,e.paymentSheet.intentType="payment",void 0!==t.withZipCode&&(e.paymentSheet.zip=t.withZipCode),e.notifyListeners(a.SQ.Loaded,null)):e.notifyListeners(a.SQ.FailedToLoad,null)})()}presentPaymentSheet(){var t=this;return(0,o.A)(function*(){if(!t.paymentSheet)throw new Error;const e=yield t.paymentSheet.present();if(void 0===e)return t.notifyListeners(a.SQ.Canceled,null),{paymentResult:a.SQ.Canceled};const{detail:{stripe:i,cardNumberElement:r}}=e,s=yield i.createPaymentMethod({type:"card",card:r});return t.paymentSheet.updateProgress("success"),t.paymentSheet.remove(),void 0!==s.error?(t.notifyListeners(a.SQ.Failed,null),{paymentResult:a.SQ.Failed}):(t.notifyListeners(a.SQ.Completed,null),{paymentResult:a.SQ.Completed})})()}createPaymentFlow(t){var e=this;return(0,o.A)(function*(){var i;e.publishableKey?(e.paymentSheet=document.createElement("stripe-payment-sheet"),null===(i=document.querySelector("body"))||void 0===i||i.appendChild(e.paymentSheet),yield customElements.whenDefined("stripe-payment-sheet"),e.paymentSheet.publishableKey=e.publishableKey,e.stripeAccount&&(e.paymentSheet.stripeAccount=e.stripeAccount),e.paymentSheet.applicationName="@capacitor-community/stripe",t.hasOwnProperty("paymentIntentClientSecret")?(e.paymentSheet.intentType="payment",e.paymentSheet.intentClientSecret=t.paymentIntentClientSecret):(e.paymentSheet.intentType="setup",e.paymentSheet.intentClientSecret=t.setupIntentClientSecret),void 0!==t.withZipCode&&(e.paymentSheet.zip=t.withZipCode),((n,t)=>("string"==typeof n&&(t=n,n=void 0),(n=>F(n))(n).includes(t)))(window,"ios")?(e.paymentSheet.buttonLabel="Add card",e.paymentSheet.sheetTitle="Add a card"):e.paymentSheet.buttonLabel="Add",e.notifyListeners(a.Vq.Loaded,null)):e.notifyListeners(a.Vq.FailedToLoad,null)})()}presentPaymentFlow(){var t=this;return(0,o.A)(function*(){if(!t.paymentSheet)throw new Error;t.notifyListeners(a.Vq.Opened,null);const e=yield t.paymentSheet.present().catch(()=>{});if(void 0===e)throw t.notifyListeners(a.Vq.Canceled,null),new Error;const{detail:{stripe:i,cardNumberElement:r}}=e,{token:s}=yield i.createToken(r);if(void 0===s||void 0===s.card)throw new Error;return t.flowStripe=i,t.flowCardNumberElement=r,t.notifyListeners(a.Vq.Created,{cardNumber:s.card.last4}),{cardNumber:s.card.last4}})()}confirmPaymentFlow(){var t=this;return(0,o.A)(function*(){if(!t.paymentSheet||!t.flowStripe||!t.flowCardNumberElement)throw new Error;return void 0!==(yield t.flowStripe.createPaymentMethod({type:"card",card:t.flowCardNumberElement})).error&&t.notifyListeners(a.Vq.Failed,null),t.paymentSheet.updateProgress("success"),t.paymentSheet.remove(),t.notifyListeners(a.Vq.Completed,null),{paymentResult:a.Vq.Completed}})()}isApplePayAvailable(){return this.isAvailable("applePay")}createApplePay(t){var e=this;return(0,o.A)(function*(){e.publishableKey?(e.requestApplePay=yield e.createPaymentRequestButton(),e.requestApplePayOptions=t,e.notifyListeners(a.$o.Loaded,null)):e.notifyListeners(a.$o.FailedToLoad,null)})()}presentApplePay(){return this.presentPaymentRequestButton("applePay",this.requestApplePay,this.requestApplePayOptions,a.$o)}isGooglePayAvailable(){return this.isAvailable("googlePay")}createGooglePay(t){var e=this;return(0,o.A)(function*(){e.publishableKey?(e.requestGooglePay=yield e.createPaymentRequestButton(),e.requestGooglePayOptions=t,e.notifyListeners(a._G.Loaded,null)):e.notifyListeners(a._G.FailedToLoad,null)})()}presentGooglePay(){return this.presentPaymentRequestButton("googlePay",this.requestGooglePay,this.requestGooglePayOptions,a._G)}isAvailable(t){var e=this;return(0,o.A)(function*(){var i;const r=document.createElement("stripe-payment-request-button");return r.id=`isAvailable-${t}`,null===(i=document.querySelector("body"))||void 0===i||i.appendChild(r),yield customElements.whenDefined("stripe-payment-request-button"),e.publishableKey&&(r.publishableKey=e.publishableKey),e.stripeAccount&&(r.stripeAccount=e.stripeAccount),r.applicationName="@capacitor-community/stripe",yield r.isAvailable(t).finally(()=>r.remove())})()}createPaymentRequestButton(){var t=this;return(0,o.A)(function*(){var e;const i=document.createElement("stripe-payment-request-button");return null===(e=document.querySelector("body"))||void 0===e||e.appendChild(i),yield customElements.whenDefined("stripe-payment-request-button"),t.publishableKey&&(i.publishableKey=t.publishableKey),t.stripeAccount&&(i.stripeAccount=t.stripeAccount),i.applicationName="@capacitor-community/stripe",i})()}presentPaymentRequestButton(t,e,i,r){var s=this;return(0,o.A)(function*(){return new Promise(function(){var x=(0,o.A)(function*(c){if(void 0===e||void 0===i||void 0===s.publishableKey)return s.notifyListeners(r.Failed,null),c({paymentResult:r.Failed});yield e.setPaymentRequestOption({country:i.countryCode.toUpperCase(),currency:i.currency.toLowerCase(),total:i.paymentSummaryItems[i.paymentSummaryItems.length-1],disableWallets:"applePay"===t?["googlePay","browserCard"]:["applePay","browserCard"],requestPayerName:!0,requestPayerEmail:!0});const v=i.paymentIntentClientSecret;yield e.setPaymentMethodEventHandler(function(){var D=(0,o.A)(function*(p,m){const{paymentIntent:h,error:g}=yield m.confirmCardPayment(v,{payment_method:p.paymentMethod.id},{handleActions:!1});if(g)return p.complete("fail"),s.notifyListeners(r.Failed,g),c({paymentResult:r.Failed});if("requires_action"===(null==h?void 0:h.status)){const{error:L}=yield m.confirmCardPayment(v);if(L)return p.complete("fail"),s.notifyListeners(r.Failed,L),c({paymentResult:r.Failed})}return p.complete("success"),s.notifyListeners(r.Completed,null),c({paymentResult:r.Completed})});return function(p,m){return D.apply(this,arguments)}}()),yield e.initStripe(s.publishableKey,{stripeAccount:s.stripeAccount,showButton:!1})});return function(c){return x.apply(this,arguments)}}())})()}}}}]);