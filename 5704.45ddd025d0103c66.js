"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[5704],{3923:(_,g,s)=>{s.d(g,{$o:()=>m,_G:()=>u,Vq:()=>y,SQ:()=>l});var m=function(n){return n.Loaded="applePayLoaded",n.FailedToLoad="applePayFailedToLoad",n.Completed="applePayCompleted",n.Canceled="applePayCanceled",n.Failed="applePayFailed",n.DidSelectShippingContact="applePayDidSelectShippingContact",n.DidCreatePaymentMethod="applePayDidCreatePaymentMethod",n}(m||{}),u=function(n){return n.Loaded="googlePayLoaded",n.FailedToLoad="googlePayFailedToLoad",n.Completed="googlePayCompleted",n.Canceled="googlePayCanceled",n.Failed="googlePayFailed",n}(u||{}),y=function(n){return n.Loaded="paymentFlowLoaded",n.FailedToLoad="paymentFlowFailedToLoad",n.Opened="paymentFlowOpened",n.Created="paymentFlowCreated",n.Completed="paymentFlowCompleted",n.Canceled="paymentFlowCanceled",n.Failed="paymentFlowFailed",n}(y||{}),l=function(n){return n.Loaded="paymentSheetLoaded",n.FailedToLoad="paymentSheetFailedToLoad",n.Completed="paymentSheetCompleted",n.Canceled="paymentSheetCanceled",n.Failed="paymentSheetFailed",n}(l||{})},5704:(_,g,s)=>{s.r(g),s.d(g,{PaymentPage:()=>D});var m=s(467),u=s(177),y=s(4341),l=s(4742),n=s(5083),C=s(3923);const f=(0,n.F3)("Stripe",{web:()=>s.e(1651).then(s.bind(s,1651)).then(o=>new o.StripeWeb)});var S=s(1594),P=s(9350),e=s(4438),x=s(3656),I=s(9568),R=s(1626),j=s(2068);function v(o,c){if(1&o){const i=e.RV6();e.j41(0,"ion-button",4),e.bIt("click",function(){e.eBV(i);const a=e.XpG();return e.Njj(a.close())}),e.EFF(1),e.k0s()}if(2&o){const i=e.XpG();e.R7$(),e.JRh(i.text.cancel)}}function k(o,c){1&o&&e.nrm(0,"ion-spinner",13)}function T(o,c){if(1&o){const i=e.RV6();e.j41(0,"ion-item",8),e.bIt("click",function(){e.eBV(i);const a=e.XpG(2);return e.Njj(a.paymentSheet())}),e.j41(1,"ion-thumbnail",9),e.nrm(2,"img",12),e.k0s(),e.j41(3,"ion-label"),e.EFF(4),e.k0s(),e.DNE(5,k,1,0,"ion-spinner",11),e.k0s()}if(2&o){const i=e.XpG(2);e.R7$(4),e.JRh(i.text.credit),e.R7$(),e.Y8G("ngIf",1==i.payment_method)}}function L(o,c){1&o&&e.nrm(0,"ion-spinner",13)}function N(o,c){if(1&o){const i=e.RV6();e.j41(0,"ion-content",5)(1,"h3"),e.EFF(2),e.j41(3,"ion-badge",6),e.EFF(4),e.k0s()(),e.nrm(5,"br")(6,"br"),e.DNE(7,T,6,2,"ion-item",7),e.nrm(8,"br"),e.j41(9,"ion-item",8),e.bIt("click",function(){e.eBV(i);const a=e.XpG();return e.Njj(a.payWithRazorpay())}),e.j41(10,"ion-label"),e.EFF(11),e.k0s(),e.j41(12,"ion-thumbnail",9),e.nrm(13,"img",10),e.k0s(),e.DNE(14,L,1,0,"ion-spinner",11),e.k0s(),e.nrm(15,"br")(16,"br")(17,"br")(18,"br"),e.j41(19,"b"),e.EFF(20,"For stripe use these Test card detail : "),e.k0s(),e.j41(21,"p"),e.EFF(22,"Card No : 4242 4242 4242 4242"),e.k0s(),e.j41(23,"p"),e.EFF(24,"Exp. 12/25 CVV : 321"),e.k0s()()}if(2&o){const i=e.XpG();e.R7$(2),e.SpI("",i.text.select_payment_method," "),e.R7$(2),e.Lme("",i.setting.currency,"",i.data.amount,""),e.R7$(3),e.Y8G("ngIf",i.setting.stripe_key),e.R7$(4),e.SpI(" ",i.text.upi,""),e.R7$(3),e.Y8G("ngIf",2==i.payment_method)}}let D=(()=>{var o;class c{constructor(t,a,r,d){this.navParams=t,this.otherService=a,this.http=r,this.server=d,this.data=t.get("data");const p=localStorage.getItem("admin_setting"),h=localStorage.getItem("user_data");null!==p&&(this.setting=JSON.parse(p)),null!==h&&(this.user=JSON.parse(h));const F=localStorage.getItem("app_lang");null!==F&&(this.text=JSON.parse(F),this.text=this.text.text),f.initialize({publishableKey:this.data.stripe_key}),this.meta={counsumer_id:778383,consumer_mac:"sdjksfhsd887f8s"},this.customizations={title:"Wallet Recharge",description:"Wallet Recharge",logo:"https://dicont.s3.amazonaws.com/static/flow-logos/flutterwave-logo.png"},this.customerDetails={name:this.user.name,email:this.user.email,phone_number:this.user.phone}}ngOnInit(){}updateWallet(t=null){var a=this;return(0,m.A)(function*(){const r={amount:a.data.amount,user_id:localStorage.getItem("user_id"),trans_id:t,payment_method:a.payment_method,notes:"Wallet Recharge"};a.server.updateWallet(r).subscribe(d=>{a.payment_method=null,a.otherService.toast(a.text.payment_added),a.close(t)})})()}close(t=null){var a=this;return(0,m.A)(function*(){a.otherService.closeModel(t)})()}httpPost(){const t={user:localStorage.getItem("user_id"),total:this.data.amount};return this.http.post(this.server.getApiUrl()+"stripePayment",t).pipe((0,S.$)())}paymentSheet(){var t=this;return(0,m.A)(function*(){t.payment_method=1;try{f.addListener(C.SQ.Completed,()=>{console.log("PaymentSheetEventsEnum.Completed")});const a=t.httpPost();console.log(a);const{paymentIntent:r,ephemeralKey:d,customer:p}=yield function b(o,c){const i="object"==typeof c;return new Promise((t,a)=>{let d,r=!1;o.subscribe({next:p=>{d=p,r=!0},error:a,complete:()=>{r?t(d):i?t(c.defaultValue):a(new P.G)}})})}(a);yield f.createPaymentSheet({paymentIntentClientSecret:r,customerId:p,customerEphemeralKeySecret:d,merchantDisplayName:t.setting.app_name});const h=yield f.presentPaymentSheet();console.log("result: ",h),h&&h.paymentResult===C.SQ.Completed?t.updateWallet(t.splitAndJoin(r)):t.otherService.toast(t.text.payment_cancel)}catch{t.otherService.toast(t.text.payment_cancel)}})()}splitAndJoin(t){const a=t.split("_").slice(0,2).join("_");return console.log(a),a}payWithRazorpay(){var t=this;return(0,m.A)(function*(){RazorpayCheckout.open({description:"Pay Now",image:"https://cdn.iconscout.com/icon/free/png-512/bhim-3-69845.png",currency:"INR",key:t.setting.razor_key,amount:100*t.data.amount,name:t.user.name,prefill:{email:t.user.email,contact:t.user.phone},theme:{color:"#2196f3"},modal:{ondismiss:function(){alert("dismissed")}}},p=>{t.updateWallet(Date.now())},p=>{t.otherService.toast(t.text.payment_cancel)})})()}}return(o=c).\u0275fac=function(t){return new(t||o)(e.rXU(x.y8),e.rXU(I.G),e.rXU(R.Qq),e.rXU(j.Z))},o.\u0275cmp=e.VBU({type:o,selectors:[["app-payment"]],decls:5,vars:2,consts:[[1,"ion-no-border"],["slot","end"],["color","medium",3,"click",4,"ngIf"],["class","ion-padding",4,"ngIf"],["color","medium",3,"click"],[1,"ion-padding"],["color","dark",2,"float","right","margin-top","5px"],["lines","none","detail","",3,"click",4,"ngIf"],["lines","none","detail","",3,"click"],["slot","start"],["src","assets/razor.png"],["name","crescent","slot","end",4,"ngIf"],["src","assets/stripe.png"],["name","crescent","slot","end"]],template:function(t,a){1&t&&(e.j41(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-buttons",1),e.DNE(3,v,2,1,"ion-button",2),e.k0s()()(),e.DNE(4,N,25,6,"ion-content",3)),2&t&&(e.R7$(3),e.Y8G("ngIf",a.text),e.R7$(),e.Y8G("ngIf",a.data&&a.text))},dependencies:[l.bv,l.In,l.Jm,l.QW,l.W9,l.eU,l.uz,l.he,l.w2,l.Zx,l.ai,u.MD,u.bT,y.YN],styles:["ion-item[_ngcontent-%COMP%]{border-radius:5px;--min-height:60px;border:1px solid #f1f1f1}ion-toolbar[_ngcontent-%COMP%]{--background: white}ion-thumbnail[_ngcontent-%COMP%]{width:32px;height:32px}"]}),c})()}}]);